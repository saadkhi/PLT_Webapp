{% extends 'base.html' %}
{% load static %}

{% block title %}{{ job.title }}{% endblock %}
{% block content %}

<style>
  form input,
  form textarea,
  form select {
    border: 1px solid #d1d5db;
    /* Tailwind border-black */
    border-radius: 0.375rem;
    /* Tailwind rounded-md */
    width: 100%;
    /* Tailwind w-full */
    padding: 0.5rem 0.75rem;
    /* Tailwind px-3 py-2 */
    transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  }

  form input:focus,
  form textarea:focus,
  form select:focus {
    outline: none;
    border-color: #f97316;
    /* Tailwind blue-500 */
    box-shadow: 0 0 0 1px #f97316;
    /* Equivalent to Tailwind ring-2 ring-blue-500 */
  }
</style>

<div class="px-2 sm:px-4 md:px-8 lg:px-8">
  <section class="py-6 sm:py-8 md:py-10">
    <div class="max-w-screen-xl mx-auto space-y-6 sm:space-y-8 md:space-y-10">

      <!-- Job Description -->
      <div class="bg-white p-4 sm:p-6 md:p-8 rounded-2xl shadow-lg">
        <h1 class="text-3xl sm:text-4xl font-bold text-black mb-4">{{ job.title }}</h1>
        <p class="text-lg text-black mb-2"><b>Location:</b> {{ job.location }}</p>
        <p class="text-lg text-black mb-6"><b>Mode:</b> {{ job.get_job_mode_display }}</p>

        <h2 class="text-xl font-semibold mb-2">About the Role</h2>
        <p class="mb-4">{{ job.about_role }}</p>

        <h2 class="text-xl font-semibold mb-2">What You Will Do</h2>
        <p class="mb-4">{{ job.responsibilities }}</p>

        <h2 class="text-xl font-semibold mb-2">What We Are Looking For</h2>
        <p class="mb-4">{{ job.requirements }}</p>

        {% if job.nice_to_have %}
        <h2 class="text-xl font-semibold mb-2">Nice to Have</h2>
        <p class="mb-4">{{ job.nice_to_have }}</p>
        {% endif %}
      </div>

      <!-- Application Form -->
      <div class="bg-white p-4 sm:p-6 md:p-8 rounded-2xl shadow-lg">
        <h2 class="text-2xl sm:text-3xl font-bold text-black mb-4">Apply for this Job</h2>
        <form id="application-form" method="post" enctype="multipart/form-data" class="space-y-4 sm:space-y-6">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit"
            class="bg-black text-white font-semibold px-4 sm:px-6 py-2 sm:py-3 rounded-xl shadow-md hover:bg-orange-500 transition">
            Submit Application
          </button>
        </form>
      </div>

      <!-- Popup Message -->
      <div id="popup-message"
        class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-4 rounded-lg shadow-lg text-center w-11/12 sm:w-3/4 md:w-1/2 max-w-sm z-50 hidden">
        <p class="text-lg font-semibold text-black">Application Submitted</p>
      </div>

    </div>
  </section>
</div>

<script>
  const form = document.getElementById('application-form');
  const popup = document.getElementById('popup-message');

  form.addEventListener('submit', function (event) {
    event.preventDefault(); // Prevent default form submission

    // Show popup
    popup.classList.remove('hidden');
    popup.classList.add('block');

    // Submit form data programmatically
    const formData = new FormData(form);
    fetch(form.action, {
      method: form.method,
      body: formData
    }).then(response => {
      // Redirect to careers page after 2 seconds
      setTimeout(() => {
        window.location.href = 'http://127.0.0.1:8000/careers';
      }, 2000);
    }).catch(error => {
      console.error('Form submission failed:', error);
      // Still redirect after 2 seconds even if submission fails
      setTimeout(() => {
        window.location.href = 'http://127.0.0.1:8000/careers';
      }, 2000);
    });
  });
</script>

{% endblock %}